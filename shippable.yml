# vim: et sr sw=2 ts=2 smartindent:
#
# Set to only build on git tag events and pull requests
# in shippable console.
language: none

env:
  global:
    - CIUSER_HOME: /home/ciuser
    - CIUSER_BUILD_DIR: /home/ciuser/build
    - CIUSER_RESULTS_DIR: /home/ciuser/shippable/testresults
    - BASH_LIBS_DIR: /home/ciuser/build/bash
    - NVM_DIR: /home/ciuser/.nvm
    - CONCURRENT_TESTS: 4
    - TEST_ROOT: bats/

build:

  ci:
    - chmod a+x shippable.*.sh ;
      (
        ./shippable.build.sh
        && ./shippable.create_ciuser.sh
        && su -c "./shippable.test.sh" ciuser ; rc=$? ;
        cp -r ${CIUSER_RESULTS_DIR}/*.xml shippable/testresults ;
        exit $rc
      )

  on_success: ./bash/bundles/release

integrations:
  notifications:
    - integrationName: opsgang_slack_delivery
      type: slack
      recipients: "#delivery"
      on_success: always
      on_failure: never
      on_pull_request: never

